{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://awf.dev/schemas/asp/1.0/task-result.json",
  "title": "ASP TaskResult",
  "description": "Agent State Protocol v1.0 Task Result Schema",
  "type": "object",
  "required": ["task_id", "status", "metrics"],
  "properties": {
    "task_id": {"type": "string", "format": "uuid"},
    "status": {"type": "string", "enum": ["completed", "failed", "partial", "needs_human"]},
    "output": {"type": ["object", "null"]},
    "error": {
      "type": "object",
      "required": ["code", "message", "category", "retriable"],
      "properties": {
        "code": {"type": "string", "pattern": "^ASP-[A-Z]+-[0-9]+$"},
        "message": {"type": "string"},
        "category": {"type": "string", "enum": ["INVALID_INPUT", "CAPABILITY_NOT_FOUND", "PERMISSION_DENIED", "RESOURCE_EXHAUSTED", "EXTERNAL_SERVICE_ERROR", "INTERNAL_ERROR", "HUMAN_INTERVENTION_REQUIRED", "CANCELLED", "TIMEOUT"]},
        "retriable": {"type": "boolean"},
        "details": {"type": "object"}
      }
    },
    "metrics": {
      "type": "object",
      "required": ["started_at", "completed_at", "duration_ms"],
      "properties": {
        "started_at": {"type": "string", "format": "date-time"},
        "completed_at": {"type": "string", "format": "date-time"},
        "duration_ms": {"type": "integer", "minimum": 0},
        "tokens_input": {"type": "integer", "minimum": 0, "default": 0},
        "tokens_output": {"type": "integer", "minimum": 0, "default": 0},
        "cost_usd": {"type": "number", "minimum": 0, "default": 0},
        "retries": {"type": "integer", "minimum": 0, "default": 0}
      }
    },
    "provenance": {
      "type": "object",
      "required": ["agent_id", "agent_version"],
      "properties": {
        "agent_id": {"type": "string", "format": "uuid"},
        "agent_version": {"type": "string"},
        "sandbox_type": {"type": "string", "enum": ["none", "wasm", "gvisor", "gvisor_strict"]},
        "model_calls": {"type": "array"},
        "reasoning_trace": {"type": "array"},
        "sources": {"type": "array"}
      }
    },
    "confidence": {"type": "number", "minimum": 0, "maximum": 1},
    "warnings": {"type": "array", "items": {"type": "string"}}
  }
}
